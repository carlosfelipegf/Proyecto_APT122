{% extends "base_dashboard.html" %}

{% block dashboard_menu %}
    {% include "includes/admin_menu.html" %} 
{% endblock dashboard_menu %}

{% block dashboard_content %}
<h1>Gestionar Solicitud #{{ solicitud.id }}</h1>
<a href="{% url 'dashboard_administrador' %}" class="btn btn-sm btn-secondary mb-3">← Volver al Dashboard</a>

<div class="card mb-4">
    <div class="card-header">Detalles de la Solicitud</div>
    <div class="card-body">
        <p><strong>Cliente:</strong> {{ solicitud.nombre_cliente }} ({{ solicitud.cliente.username }})</p>
        <p><strong>Maquinaria:</strong> {{ solicitud.maquinaria }}</p>
        <p><strong>Dirección:</strong> {{ solicitud.direccion }}</p>
        <p><strong>Teléfono:</strong> {{ solicitud.telefono }}</p>
        <p><strong>Estado:</strong> <span class="badge bg-warning text-dark">{{ solicitud.get_estado_display }}</span></p>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <h2>1. Aprobar y Asignar</h2>
        <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="action" value="aprobar">

            <div class="mb-3">
                <label for="nombre_inspeccion" class="form-label">Nombre de la Inspección</label>
                <input type="text" class="form-control" id="nombre_inspeccion" name="nombre_inspeccion" value="Inspección de {{ solicitud.maquinaria }}" required>
            </div>

            <div class="mb-3">
                <label for="tecnico" class="form-label">Asignar Técnico</label>
                <select class="form-select" id="tecnico" name="tecnico" required>
                    <option value="">Selecciona un Técnico</option>
                    {% for tecnico in tecnicos %}
                        <option value="{{ tecnico.id }}">{{ tecnico.username }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label for="plantilla" class="form-label">Seleccionar Plantilla</label>
                <select class="form-select" id="plantilla" name="plantilla" required>
                    <option value="">Selecciona una Plantilla</option>
                    {% for plantilla in plantillas %}
                        <option value="{{ plantilla.id }}">{{ plantilla.nombre }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <button type="submit" class="btn btn-success"><i class="fas fa-check"></i> Aprobar y Asignar Inspección</button>
        </form>
    </div>
    
    <div class="col-md-6">
        <h2>2. Rechazar Solicitud</h2>
        <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="action" value="rechazar">

            <div class="mb-3">
                <label for="motivo_rechazo" class="form-label">Motivo del Rechazo</label>
                <textarea class="form-control" id="motivo_rechazo" name="motivo_rechazo" rows="3" required></textarea>
            </div>
            
            <button type="submit" class="btn btn-danger"><i class="fas fa-times"></i> Rechazar</button>
        </form>
    </div>
</div>
{% endblock dashboard_content %}