{% extends 'base_dashboard.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block dashboard_menu %}
    {% include "includes/admin_menu.html" %}
{% endblock dashboard_menu %}

{% block dashboard_content %}
<script src="{% static 'js/validaciones_form.js' %}"></script>
<div class="container-fluid px-0">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 text-dark fw-bold mb-1">
                {% if es_creacion %}
                    <i class="fas fa-user-plus me-2"></i>Crear Nuevo Usuario
                {% else %}
                    <i class="fas fa-user-edit me-2"></i>Editar Usuario
                {% endif %}
            </h1>
            <p class="text-muted mb-0">
                {% if es_creacion %}
                    Ingresa los datos para registrar un nuevo usuario en el sistema.
                {% else %}
                    Modifica los datos del usuario <strong>{{ usuario_objetivo.username }}</strong>.
                {% endif %}
            </p>
        </div>
        <a href="{% url 'admin_usuarios_list' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i> Volver a la lista
        </a>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow-sm border-0">
                <div class="card-body p-4">
                    <form method="post" novalidate>
                        {% csrf_token %}
                        
                        {# Renderiza el formulario completo automáticamente usando Crispy #}
                        {# Esto evita errores de campos faltantes #}
                        {{ form|crispy }}

                        <div class="mt-4 d-flex justify-content-end gap-2">
                            <a href="{% url 'admin_usuarios_list' %}" class="btn btn-light border">Cancelar</a>
                            <button type="submit" class="btn btn-primary px-4 fw-bold">
                                <i class="fas fa-save me-2"></i>
                                {% if es_creacion %}Crear Usuario{% else %}Guardar Cambios{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="alert alert-info border-0 shadow-sm">
                <h6 class="alert-heading fw-bold"><i class="fas fa-info-circle me-2"></i>Sobre los Roles</h6>
                <hr>
                <ul class="mb-0 small ps-3">
                    <li class="mb-2"><strong>Administrador:</strong> Acceso total al sistema y gestión de usuarios.</li>
                    <li class="mb-2"><strong>Técnico:</strong> Puede recibir inspecciones y completarlas.</li>
                    <li><strong>Cliente:</strong> Puede solicitar inspecciones y ver sus órdenes.</li>
                </ul>
            </div>
        </div>
    </div>
</div>

{% endblock dashboard_content %}